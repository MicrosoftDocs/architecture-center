# Data Operations Reference Architecture for Autonomous Vehicle Operations (AVOps)

This architecture provides guidance and recommendations for developing data operations and data management (DataOps) for an automated driving solution. DataOps is one of the building block of the Microsoft AVOps reference architecture.

## Architecture

![DataOps Reference architecture.](.\images\solution-kit.png)
*Download a [Visio file](https://arch-center.azureedge.net/dataops-architecture.vsdx) that contains the architecture diagrams in this article.*

DataOps reference architecture is built upon the framework outlined in the [AVOps reference architecture](https://learn.microsoft.com).  DataOps is a set of practices, processes, and tools aimed at improving the quality, speed, and reliability of data operations.  The goal of the DataOps flow for automated driving is to ensure that the data used to control the vehicle is of high quality, accurate, and reliable. By following a consistent DataOps flow, organizations improves the speed and accuracy of their data operations and make better decisions to control their autonomous vehicles.  

Data operations in the context of automated driving refers to the processes and techniques used to collect, clean, store, manipulate, and analyze vast amounts of data generated by various sensors and systems in an automated vehicle. The goal of these operations is to extract useful information that can inform decision-making, enabling the vehicle to safely navigate its environment and interact with other road users.

Data operations in automated driving involve:

1. Data Ingestion: Collecting data from various sources such as cameras, lidar, radar, GPS, and other sensors.
1. Data Cleaning: Removing noise, correcting errors, and handling missing data to ensure that the data is accurate and reliable.
1. Data Storage: Storing the vast amounts of data generated by an autonomous vehicle in an efficient and scalable manner, such as using cloud-based storage solutions or in-vehicle data storage systems.
1. Data Manipulation: Transforming the data into a format that can be analyzed and used for decision-making. This includes techniques such as data compression, filtering, and feature extraction.
1. Data Analysis: Analyzing the data to extract useful information, such as identifying obstacles, recognizing traffic signs, and making predictions about future road conditions.

The reference architecture contains guidance about these logical building blocks and processes for DataOps, technology recommendations, partner, or open-source solutions for specific areas like simulation and data models. 

## Guiding Principles 
Based on our expierence several teams are involved in Data Operations due to complexity of the entire data loops required for Autonomous Vehicles. E. g. one team is responsible for data collection / data ingestion, another one for data quality and another team for data labeling and owning the labeled datasets for Lidar, Radar and frame data. For that reason principles of a Data Mesh architecture are considered for AVOps DataOps:

- <principle one>


## Data flow

![AVOps Reference architecture.](.\images\solution-kit.png)
> remove this if no visio file *Download a [Visio file](https://arch-center.azureedge.net/[AVOps].vsdx) of this architecture.*

1. Measurement data comes from data streams for sensors like cameras, radar, ultrasound, lidar, and vehicle telemetry. Data loggers in the vehicle store measurement data on logger storage devices. The logger storage data is then uploaded to the landing data lake. A service like [Azure Data Box](/azure/databox/) or [Azure Stack Edge](/azure/databox-online/), or a dedicated connection like [Azure ExpressRoute](/azure/expressroute/), ingests data into Azure.

    Measurement data can also be synthetic data from simulations or from other sources. (MDF4, TDMS, and rosbag are common data formats for measurements.) In the DataOps stage, ingested measurements are processed. Validation and data quality checks, like checksum, are performed to remove low quality data. In this stage, raw information metadata that's recorded by a test driver during a test drive is extracted. This data is stored in a centralized metadata catalog. This information helps downstream processes identify specific scenes and sequences.
1. Data is processed by an [Azure Data Factory](/azure/data-factory/introduction) extract, transform, and load (ETL) pipeline. The output is stored as raw and binary data in [Azure Data Lake](/azure/storage/blobs/data-lake-storage-introduction). Metadata is stored in [Azure Cosmos DB](/azure/cosmos-db). Depending on the scenario, it might then be sent to [Azure Data Explorer](/azure/data-explorer/data-explorer-overview) or [Azure Cognitive Search](/azure/cognitive-services/).
1. Additional information, insights, and context are added to the data to improve its accuracy and reliability.
1. Extracted measurement data is provided to labeling partners (human-in-the-loop) via [Azure Data Share](/azure/data-share/). Third-party partners perform auto labeling, storing and accessing data via a separate Data Lake account.
1. Labeled data sets are provided to further [MLOps](#mlops) processes, mainly to create a perception and sensor fusion model used by autonomous vehicles to detect scenes (like lane change, blocked roads, pedestrian, traffic lights, traffic signs etc.), COCO or OpenLabel are recommended formats for label data exchange
1. In the [ValOps](#valops) stage, trained models are validated via open-loop and closed-loop testing.
1. Tools like [Foxglove](https://foxglove.dev/), running on [Azure Kubernetes Service](/azure/aks/intro-kubernetes) or [Azure Container Instances](/azure/container-instances/), visualize ingested and processed data. 


## Data Flow between zones

The image below shows an example scenario of an offline/online collection of vehicle data to a data lake.  
### Data collection


Data collection is one of the main [challenges](../../guide/machine-learning/avops-design-guide.md#challenges) of Autonomous Vehicles Operations (AVOps). The following diagram shows an example of how offline and online vehicle data can be collected and stored in a data lake.

### Data Landing Zone to Raw

### Raw to Derived

### Raw to Extracted

### Extracted to Curated

### Curated to Labeled

## Meta-Data model / Common Data Model for measurement data

## Data Discovery

## DataOps Components

* [Data Box](https://azure.microsoft.com/products/databox) is used to transfer collected vehicle data to Azure via a regional carrier.
* [ExpressRoute](https://azure.microsoft.com/products/expressroute) extends the on-premises network into the Microsoft cloud over a private connection.
* [Azure Data Lake Storage](https://azure.microsoft.com/products/storage/data-lake-storage) stores data based on stages, for example, raw or extracted.
* [Azure Data Factory](https://azure.microsoft.com/products/data-factory) performs ETL via [batch compute](/azure/batch/) and creates data-driven workflows for orchestrating data movement and transforming data.
* [Azure Batch](https://azure.microsoft.com/products/batch) runs large-scale applications for tasks like data wrangling, filtering and preparing data, and extracting metadata.
* [Azure Cosmos DB](https://azure.microsoft.com/products/cosmos-db) stores metadata results, like stored measurements.
* [Data Share](https://azure.microsoft.com/products/data-share/) shares data with partner organizations, like labeling companies, with enhanced security.
* [Azure Databricks](https://azure.microsoft.com/products/databricks/) provides a set of tools for maintaining enterprise-grade data solutions at scale. It's required for long-running operations on large amounts of vehicle data. Data engineers use Azure Databricks as an analytics workbench.
* [Azure Synapse Analytics](https://azure.microsoft.com/products/synapse-analytics/) reduces time to insight across data warehouses and big data systems.
* [Azure Cognitive Search](https://azure.microsoft.com/products/search) provides data catalog search services.



## Scenario details

You can use this architecture to build a data operations for automated driving solution on Azure.


## Considerations

These considerations implement the pillars of the Azure Well-Architected Framework, which is a set of guiding tenets that can be used to improve the quality of a workload. For more information, see [Microsoft Azure Well-Architected Framework](/azure/architecture/framework).

### Reliability

Reliability ensures your application can meet the commitments you make to your customers. For more information, see [Overview of the reliability pillar](/azure/architecture/framework/resiliency/overview).

* Auto scale and reserved instances
* Geo redundancy

### Security

Security provides assurances against deliberate attacks and the abuse of your valuable data and systems. For more information, see [Overview of the security pillar](/azure/architecture/framework/security/overview).

It's important to understand the division of responsibility between the automotive OEM and Microsoft. In the vehicle, the OEM owns the whole stack, but as the data moves to the cloud, some responsibilities transfer to Microsoft. Azure platform-as-a-service (PaaS) provides built-in security on the physical stack, including the operating system. You can apply the following capabilities on top of the infrastructure security components.

* Private endpoints for network security. For more information, see [Private endpoints for Azure Data Explorer](https://learn.microsoft.com/azure/data-explorer/security-network-private-endpoint) and [Allow access to Azure Event Hubs namespaces via private endpoints](https://learn.microsoft.com/azure/event-hubs/private-link-service).
* Encryption at rest and in transit.
* Identity and access management that uses Azure Active Directory (Azure AD) identities and [Azure AD Conditional Access](https://learn.microsoft.com/azure/active-directory/conditional-access) policies.
* [Row Level Security (RLS)](https://learn.microsoft.com/azure/active-directory/conditional-access) for Azure Data Explorer.
* Infrastructure governance that uses [Azure Policy](https://azure.microsoft.com/services/azure-policy).
* Data governance that uses [Microsoft Purview](https://azure.microsoft.com/services/purview).
* Securing the connection of the vehicles - certificate management
* Verify explicitly: Always authenticate and authorize based on all available data points
* Use least privilege access: Limit user access with Just-In-Time and Just-Enough-Access (JIT/JEA), risk-based adaptive policies, and data protection
* Assume breach: Minimize blast radius and segment access. Verify end-to-end encryption and use analytics to get visibility, drive threat detection and improve defenses
* Secure development lifecycle will be used
* These points will drive a Zero Trust Strategy
* It should be clarified if security relevant events must be stored in a central security log analytics workspace
* It should be clarified if “bring your own key” (BYOK) is required. Some customers in automotive sectors are using BYOK


### Cost optimization


### Operational excellence

Operational excellence covers the operations processes that deploy an application and keep it running in production. For more information, see [Overview of the operational excellence pillar](/azure/architecture/framework/devops/overview).

### Performance efficiency

Performance efficiency is the ability of your workload to scale to meet the demands placed on it by users in an efficient manner. For more information, see [Performance efficiency pillar overview](/azure/architecture/framework/scalability/overview).

## Contributors 
*This article is maintained by Microsoft. It was originally written by the following contributors.*

Principal authors: > Only the primary authors. Listed alphabetically by last name. Use this format: Fname Lname. If the article gets rewritten, keep the original authors and add in the new one(s).

 - [Ryan Matsumura](https://www.linkedin.com/in/ryan-matsumura-4167257b/) | Senior Program Manager
 - [Jochen Schroeer](https://www.linkedin.com/in/jochen-schroeer/) | Lead Architect (Service Line Mobility)

Other contributors: 
- [Ginette Vellera](https://www.linkedin.com/in/ginette-vellera-35523314/) | Senior Software Engineering Lead
- [Brij Singh](https://www.linkedin.com/in/brijraajsingh/) | Principal Software Engineer
*To see non-public LinkedIn profiles, sign in to LinkedIn.*

## Next steps

- [What is Azure Machine Learning?](/azure/machine-learning/overview-what-is-azure-machine-learning)
- [What is Azure Batch?](/azure/batch/batch-technical-overview)
- [Azure Data Factory documentation](/azure/data-factory/)
- [What is Azure Data Share?](/azure/data-share/overview)
- [Large-scale Data Operations Platform for Autonomous Vehicles](https://devblogs.microsoft.com/cse/2023/03/02/large-scale-data-operations-platform-for-autonomous-vehicles/)

## Related resources

* [AVOps design guide](../../guide/machine-learning/avops-design-guide.md)
* [Data analytics for automotive test fleets](../../industries/automotive/automotive-telemetry-analytics.yml)
* [Building blocks for autonomous-driving simulation environments](../../industries/automotive/building-blocks-autonomous-driving-simulation-environments.yml)
- [Building blocks for autonomous-driving simulation environments](../../industries/automotive/building-blocks-autonomous-driving-simulation-environments.yml)
- [Process real-time vehicle data using IoT](../../example-scenario/data/realtime-analytics-vehicle-iot.yml)